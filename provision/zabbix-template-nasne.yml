---
- hosts: all
  become: no
  gather_facts: no
  vars_files:
  - vars/{{ stage }}.yml

  tasks:
  - name: '0 Template nasne monitor'
    zabbix_template:
      login_user: "{{ zbx_login_user }}"
      login_password: "{{ zbx_login_password }}"
      server_url: "{{ zbx_server_url }}"
      state: present
      #link_templates:
      #macros:
      template_name: '0 Template nasne monitor'
      template_groups:
      - '0 My Templates'
      template_json:
        zabbix_export:
          version: '4.0'
          graphs:
          - graph_items:
            - calc_fnc: '2'
              color: '6666FF'
              drawtype: '0'
              item:
                host: '0 Template nasne monitor'
                key: 'nasne.hdd.used'
              sortorder: '0'
              type: '0'
              yaxisside: '0'
            - calc_fnc: '2'
              color: '66FF66'
              drawtype: '0'
              item:
                host: '0 Template nasne monitor'
                key: 'nasne.hdd.free'
              sortorder: '1'
              type: '0'
              yaxisside: '0'
            height: '200'
            name: 'nasne HDD usage'
            percent_left: '0.0000'
            percent_right: '0.0000'
            show_3d: '0'
            show_legend: '1'
            show_triggers: '1'
            show_work_period: '1'
            type: '1'
            width: '900'
            yaxismax: '100.0000'
            yaxismin: '0.0000'
            ymax_item_1: '0'
            ymax_type_1: '0'
            ymin_item_1: '0'
            ymin_type_1: '0'
          - graph_items:
            - calc_fnc: '2'
              color: '6666FF'
              drawtype: '0'
              item:
                host: '0 Template nasne monitor'
                key: 'nasne.hdd.used'
              sortorder: '0'
              type: '0'
              yaxisside: '0'
            - calc_fnc: '2'
              color: '66FF66'
              drawtype: '0'
              item:
                host: '0 Template nasne monitor'
                key: 'nasne.hdd.free'
              sortorder: '1'
              type: '0'
              yaxisside: '0'
            height: '300'
            name: 'nasne HDD Usage (%)'
            percent_left: '0.0000'
            percent_right: '0.0000'
            show_3d: '0'
            show_legend: '1'
            show_triggers: '0'
            show_work_period: '0'
            type: '2'
            width: '450'
            yaxismax: '0.0000'
            yaxismin: '0.0000'
            ymax_item_1: '0'
            ymax_type_1: '0'
            ymin_item_1: '0'
            ymin_type_1: '0'
          - graph_items:
            - calc_fnc: '2'
              color: '66FF66'
              drawtype: '5'
              item:
                host: '0 Template nasne monitor'
                key: 'nasne.status.play'
              sortorder: '0'
              type: '0'
              yaxisside: '0'
            - calc_fnc: '2'
              color: '9999FF'
              drawtype: '5'
              item:
                host: '0 Template nasne monitor'
                key: 'nasne.status.live'
              sortorder: '1'
              type: '0'
              yaxisside: '0'
            - calc_fnc: '2'
              color: 'FF6666'
              drawtype: '5'
              item:
                host: '0 Template nasne monitor'
                key: 'nasne.status.rec'
              sortorder: '2'
              type: '0'
              yaxisside: '0'
            height: '200'
            name: 'nasne status'
            percent_left: '0.0000'
            percent_right: '0.0000'
            show_3d: '0'
            show_legend: '1'
            show_triggers: '1'
            show_work_period: '1'
            type: '0'
            width: '900'
            yaxismax: '1.0000'
            yaxismin: '0.0000'
            ymax_item_1: '0'
            ymax_type_1: '1'
            ymin_item_1: '0'
            ymin_type_1: '1'
          groups:
          - name: '0 My Templates'
          templates:
          - applications:
            - name: 'nasne'
            description: ''
            discovery_rules: []
            groups:
            - name: '0 My Templates'
            items:
            - allow_traps: '0'
              allowed_hosts: ''
              applications:
              - name: 'nasne'
              authtype: '0'
              delay: '0'
              description: ''
              follow_redirects: '1'
              headers: []
              history: '90d'
              http_proxy: ''
              inventory_link: '0'
              ipmi_sensor: ''
              jmx_endpoint: ''
              key: 'nasne.hdd.free'
              logtimefmt: ''
              master_item: ''
              name: 'nasne HDD free'
              output_format: '0'
              params: ''
              password: ''
              port: ''
              post_type: '0'
              posts: ''
              preprocessing: ''
              privatekey: ''
              publickey: ''
              query_fields: []
              request_method: '0'
              retrieve_mode: '0'
              snmp_community: ''
              snmp_oid: ''
              snmpv3_authpassphrase: ''
              snmpv3_authprotocol: '0'
              snmpv3_contextname: ''
              snmpv3_privpassphrase: ''
              snmpv3_privprotocol: '0'
              snmpv3_securitylevel: '0'
              snmpv3_securityname: ''
              ssl_cert_file: ''
              ssl_key_file: ''
              ssl_key_password: ''
              status: '0'
              status_codes: '200'
              timeout: '3s'
              trends: '3650d'
              type: '2'
              units: 'byte'
              url: ''
              username: ''
              value_type: '3'
              valuemap: []
              verify_host: '0'
              verify_peer: '0'
            - allow_traps: '0'
              allowed_hosts: ''
              applications:
              - name: 'nasne'
              authtype: '0'
              delay: '60'
              description: ''
              follow_redirects: '1'
              headers: ''
              history: '90d'
              http_proxy: ''
              inventory_link: '0'
              ipmi_sensor: ''
              jmx_endpoint: ''
              key: 'nasne.hdd.free.percent'
              logtimefmt: ''
              master_item: ''
              name: 'nasne HDD free (%)'
              output_format: '0'
              params: '100*last("nasne.hdd.free")/(last("nasne.hdd.free")+last(nasne.hdd.used))'
              password: ''
              port: ''
              post_type: '0'
              posts: ''
              preprocessing: ''
              privatekey: ''
              publickey: ''
              query_fields: []
              request_method: '0'
              retrieve_mode: '0'
              snmp_community: ''
              snmp_oid: ''
              snmpv3_authpassphrase: ''
              snmpv3_authprotocol: '0'
              snmpv3_contextname: ''
              snmpv3_privpassphrase: ''
              snmpv3_privprotocol: '0'
              snmpv3_securitylevel: '0'
              snmpv3_securityname: ''
              ssl_cert_file: ''
              ssl_key_file: ''
              ssl_key_password: ''
              status: '0'
              status_codes: '200'
              timeout: '3s'
              trends: '3650d'
              type: '15'
              units: '%'
              url: ''
              username: ''
              value_type: '0'
              valuemap: []
              verify_host: '0'
              verify_peer: '0'
            - allow_traps: '0'
              allowed_hosts: ''
              applications:
              - name: 'nasne'
              authtype: '0'
              delay: '0'
              description: ''
              follow_redirects: '1'
              headers: ''
              history: '90d'
              http_proxy: ''
              inventory_link: '0'
              ipmi_sensor: ''
              jmx_endpoint: ''
              key: 'nasne.hdd.used'
              logtimefmt: ''
              master_item: ''
              name: 'nasne HDD used'
              output_format: '0'
              params: ''
              password: ''
              port: ''
              post_type: '0'
              posts: ''
              preprocessing: ''
              privatekey: ''
              publickey: ''
              query_fields: []
              request_method: '0'
              retrieve_mode: '0'
              snmp_community: ''
              snmp_oid: ''
              snmpv3_authpassphrase: ''
              snmpv3_authprotocol: '0'
              snmpv3_contextname: ''
              snmpv3_privpassphrase: ''
              snmpv3_privprotocol: '0'
              snmpv3_securitylevel: '0'
              snmpv3_securityname: ''
              ssl_cert_file: ''
              ssl_key_file: ''
              ssl_key_password: ''
              status: '0'
              status_codes: '200'
              timeout: '3s'
              trends: '3650d'
              type: '2'
              units: 'byte'
              url: ''
              username: ''
              value_type: '3'
              valuemap: []
              verify_host: '0'
              verify_peer: '0'
            - allow_traps: '0'
              allowed_hosts: ''
              applications:
              - name: 'nasne'
              authtype: '0'
              delay: '60'
              description: ''
              follow_redirects: '1'
              headers: ''
              history: '90d'
              http_proxy: ''
              inventory_link: '0'
              ipmi_sensor: ''
              jmx_endpoint: ''
              key: 'nasne.hdd.used.percent'
              logtimefmt: ''
              master_item: ''
              name: 'nasne HDD used (%)'
              output_format: '0'
              params: '100*last("nasne.hdd.used")/(last("nasne.hdd.free")+last(nasne.hdd.used))'
              password: ''
              port: ''
              post_type: '0'
              posts: ''
              preprocessing: ''
              privatekey: ''
              publickey: ''
              query_fields: []
              request_method: '0'
              retrieve_mode: '0'
              snmp_community: ''
              snmp_oid: ''
              snmpv3_authpassphrase: ''
              snmpv3_authprotocol: '0'
              snmpv3_contextname: ''
              snmpv3_privpassphrase: ''
              snmpv3_privprotocol: '0'
              snmpv3_securitylevel: '0'
              snmpv3_securityname: ''
              ssl_cert_file: ''
              ssl_key_file: ''
              ssl_key_password: ''
              status: '0'
              status_codes: '200'
              timeout: '3s'
              trends: '3650d'
              type: '15'
              units: '%'
              url: ''
              username: ''
              value_type: '0'
              valuemap: []
              verify_host: '0'
              verify_peer: '0'
            - allow_traps: '0'
              allowed_hosts: ''
              applications:
              - name: 'nasne'
              authtype: '0'
              delay: '0'
              description: ''
              follow_redirects: '1'
              headers: ''
              history: '3650d'
              http_proxy: ''
              inventory_link: '0'
              ipmi_sensor: ''
              jmx_endpoint: ''
              key: 'nasne.log.rec'
              logtimefmt: 'yyyy-MM-ddThh:mm:ss+09:00'
              master_item: ''
              name: 'nasne recording log'
              output_format: '0'
              params: ''
              password: ''
              port: ''
              post_type: '0'
              posts: ''
              preprocessing: ''
              privatekey: ''
              publickey: ''
              query_fields: []
              request_method: '0'
              retrieve_mode: '0'
              snmp_community: ''
              snmp_oid: ''
              snmpv3_authpassphrase: ''
              snmpv3_authprotocol: '0'
              snmpv3_contextname: ''
              snmpv3_privpassphrase: ''
              snmpv3_privprotocol: '0'
              snmpv3_securitylevel: '0'
              snmpv3_securityname: ''
              ssl_cert_file: ''
              ssl_key_file: ''
              ssl_key_password: ''
              status: '0'
              status_codes: '200'
              timeout: '3s'
              trends: '0'
              type: '2'
              units: ''
              url: ''
              username: ''
              value_type: '2'
              valuemap: []
              verify_host: '0'
              verify_peer: '0'
            - allow_traps: '0'
              allowed_hosts: ''
              applications:
              - name: 'nasne'
              authtype: '0'
              delay: '0'
              description: ''
              follow_redirects: '1'
              headers: ''
              history: '90d'
              http_proxy: ''
              inventory_link: '0'
              ipmi_sensor: ''
              jmx_endpoint: ''
              key: 'nasne.status.live'
              logtimefmt: ''
              master_item: ''
              name: 'nasne LIVE'
              output_format: '0'
              params: ''
              password: ''
              port: ''
              post_type: '0'
              posts: ''
              preprocessing: ''
              privatekey: ''
              publickey: ''
              query_fields: []
              request_method: '0'
              retrieve_mode: '0'
              snmp_community: ''
              snmp_oid: ''
              snmpv3_authpassphrase: ''
              snmpv3_authprotocol: '0'
              snmpv3_contextname: ''
              snmpv3_privpassphrase: ''
              snmpv3_privprotocol: '0'
              snmpv3_securitylevel: '0'
              snmpv3_securityname: ''
              ssl_cert_file: ''
              ssl_key_file: ''
              ssl_key_password: ''
              status: '0'
              status_codes: '200'
              timeout: '3s'
              trends: '3650d'
              type: '2'
              units: ''
              url: ''
              username: ''
              value_type: '3'
              valuemap: []
              verify_host: '0'
              verify_peer: '0'
            - allow_traps: '0'
              allowed_hosts: ''
              applications:
              - name: 'nasne'
              authtype: '0'
              delay: '0'
              description: ''
              follow_redirects: '1'
              headers: ''
              history: '90d'
              http_proxy: ''
              inventory_link: '0'
              ipmi_sensor: ''
              jmx_endpoint: ''
              key: 'nasne.status.play'
              logtimefmt: ''
              master_item: ''
              name: 'nasne PLAY'
              output_format: '0'
              params: ''
              password: ''
              port: ''
              post_type: '0'
              posts: ''
              preprocessing: ''
              privatekey: ''
              publickey: ''
              query_fields: []
              request_method: '0'
              retrieve_mode: '0'
              snmp_community: ''
              snmp_oid: ''
              snmpv3_authpassphrase: ''
              snmpv3_authprotocol: '0'
              snmpv3_contextname: ''
              snmpv3_privpassphrase: ''
              snmpv3_privprotocol: '0'
              snmpv3_securitylevel: '0'
              snmpv3_securityname: ''
              ssl_cert_file: ''
              ssl_key_file: ''
              ssl_key_password: ''
              status: '0'
              status_codes: '200'
              timeout: '3s'
              trends: '3650d'
              type: '2'
              units: ''
              url: ''
              username: ''
              value_type: '3'
              valuemap: []
              verify_host: '0'
              verify_peer: '0'
            - allow_traps: '0'
              allowed_hosts: ''
              applications:
              - name: 'nasne'
              authtype: '0'
              delay: '0'
              description: ''
              follow_redirects: '1'
              headers: ''
              history: '90d'
              http_proxy: ''
              inventory_link: '0'
              ipmi_sensor: ''
              jmx_endpoint: ''
              key: 'nasne.status.rec'
              logtimefmt: ''
              master_item: ''
              name: 'nasne REC'
              output_format: '0'
              params: ''
              password: ''
              port: ''
              post_type: '0'
              posts: ''
              preprocessing: ''
              privatekey: ''
              publickey: ''
              query_fields: []
              request_method: '0'
              retrieve_mode: '0'
              snmp_community: ''
              snmp_oid: ''
              snmpv3_authpassphrase: ''
              snmpv3_authprotocol: '0'
              snmpv3_contextname: ''
              snmpv3_privpassphrase: ''
              snmpv3_privprotocol: '0'
              snmpv3_securitylevel: '0'
              snmpv3_securityname: ''
              ssl_cert_file: ''
              ssl_key_file: ''
              ssl_key_password: ''
              status: '0'
              status_codes: '200'
              timeout: '3s'
              trends: '3650d'
              type: '2'
              units: ''
              url: ''
              username: ''
              value_type: '3'
              valuemap: []
              verify_host: '0'
              verify_peer: '0'
            macros: []
            name: '0 Template nasne monitor'
            screens:
            - hsize: '1'
              name: 'nasne disk usage and status'
              screen_items:
              - application: ''
                colspan: '1'
                dynamic: '0'
                elements: '0'
                halign: '0'
                height: '80'
                max_columns: '3'
                resource:
                  host: '0 Template nasne monitor'
                  name: 'nasne HDD usage'
                resourcetype: '0'
                rowspan: '1'
                sort_triggers: '0'
                style: '0'
                url: ''
                valign: '0'
                width: '800'
                x: '0'
                y: '0'
              - application: ''
                colspan: '1'
                dynamic: '0'
                elements: '0'
                halign: '0'
                height: '130'
                max_columns: '3'
                resource:
                  host: '0 Template nasne monitor'
                  name: 'nasne status'
                resourcetype: '0'
                rowspan: '1'
                sort_triggers: '0'
                style: '0'
                url: ''
                valign: '0'
                width: '800'
                x: '0'
                y: '1'
              vsize: '2'
            template: '0 Template nasne monitor'
            templates: []
          triggers:
          - correlation_mode: '0'
            correlation_tag: ''
            dependencies: []
            description: ''
            expression: '{0 Template nasne monitor:nasne.hdd.free.percent.last()}<1'
            manual_close: '0'
            name: 'disk free < 1%'
            priority: '4'
            recovery_expression: ''
            recovery_mode: '0'
            status: '0'
            tags: []
            type: '0'
            url: ''
          - correlation_mode: '0'
            correlation_tag: ''
            dependencies:
            - name: 'disk free < 1%'
              expression: '{0 Template nasne monitor:nasne.hdd.free.percent.last()}<1'
              recovery_expression: ''
            description: ''
            expression: '{0 Template nasne monitor:nasne.hdd.free.percent.last()}<3'
            manual_close: '0'
            name: 'disk free < 3%'
            priority: '3'
            recovery_expression: ''
            recovery_mode: '0'
            status: '0'
            tags: []
            type: '0'
            url: ''
          - correlation_mode: '0'
            correlation_tag: ''
            dependencies:
            - name: 'disk free < 3%'
              expression: '{0 Template nasne monitor:nasne.hdd.free.percent.last()}<3'
              recovery_expression: ''
            description: ''
            expression: '{0 Template nasne monitor:nasne.hdd.free.percent.last()}<5'
            manual_close: '0'
            name: 'disk free < 5%'
            priority: '2'
            recovery_expression: ''
            recovery_mode: '0'
            status: '0'
            tags: []
            type: '0'
            url: ''
          - correlation_mode: '0'
            correlation_tag: ''
            dependencies: []
            description: ''
            expression: '{0 Template nasne monitor:nasne.log.rec.diff(0)}=1 and {0 Template nasne monitor:nasne.status.rec.last(#1)}=1'
            manual_close: '0'
            name: 'Recording'
            priority: '1'
            recovery_expression: ''
            recovery_mode: '0'
            status: '0'
            tags: []
            type: '1'
            url: ''
